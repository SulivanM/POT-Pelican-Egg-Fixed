#! /bin/bash
echo "Path Of Titans Egg Star-X"
echo "(c) Copyright 2024 - SwitchCompagnie"
# Déplacer vers le répertoire du serveur
cd /mnt/server

# Installer les utilitaires nécessaires
echo "Installing Utils"
apt update
apt install -y wget

# Télécharger et rendre exécutable AlderonGamesCmd
echo "Downloading AlderonGamesCmd"
wget -O AlderonGamesCmd https://launcher-cdn.alderongames.com/AlderonGamesCmd-Linux-x64
chmod +x AlderonGamesCmd

# Créer le répertoire pour extraire les fichiers intégrés
echo "Creating directory for extracting bundled files"
mkdir -p /home/container/AlderonGamesCmd/

# Mise à jour des fichiers du serveur
echo "Updating Files"
export DOTNET_SYSTEM_GLOBALIZATION_INVARIANT=1
./AlderonGamesCmd --game path-of-titans --server true --auth-token $AG_AUTH_TOKEN --beta-branch $BETA_BRANCH --install-dir .

# Vérifier si les fichiers de démarrage et de configuration ont été téléchargés avec succès
if [ -s "/mnt/server/PathOfTitans/Saved/Config/LinuxServer/Game.ini" ] && [ -s "/mnt/server/startup.sh" ]; then
    # Création des répertoires pour les fichiers de configuration
    echo "Creating folder for config files because this game is a weird one"
    mkdir -p /mnt/server/PathOfTitans/Saved/Config/LinuxServer

    echo "Install Finished !"
else
    echo "Error: Failed to download startup script or default config files from Github"
    exit 1
fi
